---
title: Tek Giriş/Çıkışa Sahip Odada Ziyaretçi Sayma
---
Başlık sanki biraz uzun oldu ama bugünün konusu da bu. EE 321, Microprocessors dersi için bir proje yapmamız gerekiyordu. Tabi dersin adı böyle olunca benim beklentilerim çok daha ileri seviyede olmuştu ama hocamız Arduino üzerinden bir proje geliştireceğimizi söyleyince CanSat projesinden bir takım arkadaşımla ekip olmaya ve yapmaya karar verdik. Bir çok projede olduğu gibi bu projede de bir fikirde karar kılmak oldukça zor olabilirdi. Neyse ki hocamız bize geçmiş sene yapılan veya denenen projelerden bahsetti. Bu bize biraz ilham verdi. Hocanında üzerinde durduğu ve önceki yıllarda denenmiş ama yapılamamış, bir odanın dolu ya da boş olmasını sağlayacak bir projeyi yapmaya karar verdik. Mantığı içeride ki kişi sayısını sayma üzerine kurduk. Kapının iç ve dış tarafına birer sensör koyup giren çıkan sayılarını alacaktık. Başta çok basit geldi ama projeyi internette aramaya başlayınca olaylar koptu.

Bilirsiniz internette yapılmış birşeyi yapmak kolaydır. Hatta söz konusu Arduino olunca yapılmış bir proje, konuşulmuş bir konu veya bir tutorial bulmak işten ile değil. Ancak yapmak istediğimiz şeyi internette arayınca hazin bir sonla karşılaştık. Kimse ya böyle birşey yapmamış, ya da hiç paylaşma gereği duymamış. Neyse biz yine de yapalım en kötü ilk yapanlar oluruz dedik (-ki bunu ilk yapanlar olduğumuzu en ufak sanmıyorum ama herkes bir girişi bir de çıkışı olan sistemler yapmışlar. Bizde giriş ve çıkış aynı kapıdan olacak.). Proje için sonar sensörün en makul fiyatlı ve en efektif çözüm olduğuna karar verdik. Belirli zaman aralıklarında okuyacağımız datalar ile kişilerin içeride ya da dışarıda olduğunu tespit edebilecektik. Buglardan sistemin sıkıntıya girmemesi için de bazı cover caseleri düşündük. 

Sonar sensör kullandığımız için hata payı yüksek olabiliyor. Çünkü bir birine çok yakın aralıklarda ölçüm yapmamız gerekiyor. Burada çıkabilecek örnek bir bug, çıkan kişi sayısını fazla girip içeride insan olduğu halde odayı boş gösterme durumu. Bunu önlemek için üçüncü bir sensörle projeye destek olmaya karar verdik. Bir PIR sensörü bulduk. Daha önce ben duymamıştım bu sensörü ama hareket sensörüymüş. Bu tuvaletlerde ışıkları yakan cinsten bir parçaydı. İçeride 0 kişi var ve hareket varsa kişi sayısını arttır dedik ve basitçe çözdük bu sorunu. Bir diğer benzer bug ise içeri giren sayısı çok yazılır ve insanlar çıktığı takdirde hala içeride insan var gibi göstermesi durumu. Bu durum içinde yaklaşık 10 dakikalık bir zaman aralığında ölçüm yapalım dedik. Yine PIR sensörüyle eğer 10 dakika içinde hareket algılanmaz ve içeride insan var olarak gözüküyorsa kişi sayısını sıfıra indirsin dedik.Bu da oldukça başarılı çalışan bir model oldu. 

Uzun zaman alacağını düşündüğümüz projeye sonunda bugün başlayabildik. Önceden sınav, ödev ve diğer projeleri aradan çıkarıp bu proje için zaman yaratalım istemiştik. Mesela bir diğer blog yazım olan Apple RSS Center o yüzden olması gerekenden erken bitmiş ama başka bir dersin ödevi yüzünden aksiyon alamamıştık. Neyse hasbel kader artık işe girelim dedik ve bugün başına oturduğumuz projeden akşam vakitlerinde başarılı sonuç alarak ayrıldık. Artık sistemi fiziksel olarak kurup bir oda da düzgün çalışması için optimize edilmesi kaldı. Sanıyorum ki birkaç gün içerisinde bunu da bitirip finallere odaklanabileceğiz. Ama işin en çetrefilli kısmı hallolmuş oldu. Özellikle "result == 5", "return == false;" veya kopyala-yapıştır esnasında değiştirilmeyi unutulmuş variable sorunları başımıza büyük çorap örse de Gürol'ün beni uyarmasıyla düzelttik ve sistemi çalışır hale getirdik. Bu projeyi yaparken dışarıdan bir çift gözün bir programcının arkasını nasıl kolladığını canlı şekilde görmüş oldum.

Eğer sizde böyle tek giriş/çıkıştan kişi sayısını saymak konusunda bir sıkıntınız olursa github sayfamda projenin detaylarını bulabilirsiniz. "Sonar-Sensor-Room-Visitor-With-Single-Entrance" gibi kötü bir isimle projeyi yükledim. Zaman içerisinde ESP entegrasyonu ve sensör optimizasyonu da eklenecek. Ama zaten böyle bir yazıyı okuyup faydalana kadar çoktan bunu da yapmış oluruz diye düşünüyorum.
